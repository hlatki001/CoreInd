<!DOCTYPE html>
<html lang="pt-br">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="CoreInd - A Indústria 4.0">
  <meta name="author" content="Luis Hlatki">

  <title><%= siteName %></title>

  <!-- Custom fonts for this template-->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link
    href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
    rel="stylesheet">

  <!-- Custom styles for this template-->
  <link href="css/sb-admin-2.css" rel="stylesheet">

  <link href='https://unpkg.com/@fullcalendar/core@4.4.0/main.min.css' rel='stylesheet' />

  <link href='https://unpkg.com/@fullcalendar/daygrid@4.4.0/main.min.css' rel='stylesheet' />

  <link href='https://unpkg.com/@fullcalendar/timegrid@4.4.0/main.min.css' rel='stylesheet' />

  <link rel="shortcut icon" href="/img/favicon.png" type="image/x-icon" />

</head>

<body id="page-top">
  <style>
    

    .fc-content .fc-time {display: none;}
    .fc-content .fc-title {font-weight: bold;}

    .fc-bg .fc-sat {
      background-color: #f7f7f7 !important;
    }

    .fc-bg .fc-sun {
      background-color: #f7f7f7 !important;
    }

    .popper,
    .tooltip {
      position: absolute;
      z-index: 9999;
      background: #FFC107;
      color: black;
      width: 150px;
      border-radius: 3px;
      box-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
      padding: 10px;
      text-align: center;
    }

    .style5 .tooltip {
      background: #1E252B;
      color: #FFFFFF;
      max-width: 200px;
      width: auto;
      font-size: .8rem;
      padding: .5em 1em;
    }

    .popper .popper__arrow,
    .tooltip .tooltip-arrow {
      width: 0;
      height: 0;
      border-style: solid;
      position: absolute;
      margin: 5px;
    }

    .tooltip .tooltip-arrow,
    .popper .popper__arrow {
      border-color: #FFC107;
    }

    .style5 .tooltip .tooltip-arrow {
      border-color: #1E252B;
    }

    .popper[x-placement^="top"],
    .tooltip[x-placement^="top"] {
      margin-bottom: 5px;
    }

    .popper[x-placement^="top"] .popper__arrow,
    .tooltip[x-placement^="top"] .tooltip-arrow {
      border-width: 5px 5px 0 5px;
      border-left-color: transparent;
      border-right-color: transparent;
      border-bottom-color: transparent;
      bottom: -5px;
      left: calc(50% - 5px);
      margin-top: 0;
      margin-bottom: 0;
    }

    .popper[x-placement^="bottom"],
    .tooltip[x-placement^="bottom"] {
      margin-top: 5px;
    }

    .tooltip[x-placement^="bottom"] .tooltip-arrow,
    .popper[x-placement^="bottom"] .popper__arrow {
      border-width: 0 5px 5px 5px;
      border-left-color: transparent;
      border-right-color: transparent;
      border-top-color: transparent;
      top: -5px;
      left: calc(50% - 5px);
      margin-top: 0;
      margin-bottom: 0;
    }

    .tooltip[x-placement^="right"],
    .popper[x-placement^="right"] {
      margin-left: 5px;
    }

    .popper[x-placement^="right"] .popper__arrow,
    .tooltip[x-placement^="right"] .tooltip-arrow {
      border-width: 5px 5px 5px 0;
      border-left-color: transparent;
      border-top-color: transparent;
      border-bottom-color: transparent;
      left: -5px;
      top: calc(50% - 5px);
      margin-left: 0;
      margin-right: 0;
    }

    .popper[x-placement^="left"],
    .tooltip[x-placement^="left"] {
      margin-right: 5px;
    }

    .popper[x-placement^="left"] .popper__arrow,
    .tooltip[x-placement^="left"] .tooltip-arrow {
      border-width: 5px 0 5px 5px;
      border-top-color: transparent;
      border-right-color: transparent;
      border-bottom-color: transparent;
      right: -5px;
      top: calc(50% - 5px);
      margin-left: 0;
      margin-right: 0;
    }
  </style>

  <!-- Page Wrapper -->
  <div id="wrapper">

    <!-- Sidebar -->

    <%- include ../partials/navigation.ejs %>

    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">

        <!-- Topbar -->
        <%- include ../partials/user_interface.ejs %>

        <!-- End of Topbar -->

        <!-- Begin Page Content -->
        <div class="container-fluid">

          <!-- Page Heading -->
          <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <h1 class="h3 mb-0 text-gray-800">Calendário de Manutenções</h1>
          </div>

          <!-- Content Row -->
          <div class="row">

            <div class="col-md-12">
              <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                  <h6 class="m-0 font-weight-bold text-primary">Calendário de Tarefas Agendadas</h6>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                  <div id='calendar'></div>
                </div>
              </div>
            </div>



          </div>
        </div>
      </div>
      <!-- End of Main Content -->

      <!-- Footer -->
      <footer class="sticky-footer bg-white">
        <div class="container my-auto">
          <div class="copyright text-center my-auto">
            <span>Copyright &copy; <%= siteName %></span>
          </div>
        </div>
      </footer>
      <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <!-- Logout Modal-->


  <%- include ../partials/footer.ejs %>



  <!-- Bootstrap core JavaScript-->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom scripts for all pages-->
  <script src="js/sb-admin-2.min.js"></script>

  <!-- Page level plugins -->
  <script src="vendor/chart.js/Chart.min.js"></script>

  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

  <script src="js/user-info.js"></script>


  <script src='https://unpkg.com/@fullcalendar/core@4.4.0/main.min.js'></script>




  <script src='https://unpkg.com/@fullcalendar/interaction@4.4.0/main.min.js'></script>

  <script src='https://unpkg.com/@fullcalendar/daygrid@4.4.0/main.min.js'></script>

  <script src='https://unpkg.com/@fullcalendar/timegrid@4.4.0/main.min.js'></script>
  <script src='https://unpkg.com/@fullcalendar/core@4.4.0/locales-all.js'></script>

  <script src='https://unpkg.com/popper.js/dist/umd/popper.min.js'></script>
  <script src='https://unpkg.com/tooltip.js/dist/umd/tooltip.min.js'></script>

  <script>

    function BuildCalendar(data) {

      var calendarEl = document.getElementById('calendar');
      var data = data;

     
      var calendar = new FullCalendar.Calendar(calendarEl, {
        plugins: ['interaction', 'dayGrid', 'timeGrid'],
        defaultView: 'dayGridMonth',
        defaultDate: moment().format(),
        header: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        locale: 'pt-br',
        contentHeight: 500,
        eventLimit: true,
        events: data,
        eventRender: function (info) {
          $(info.el).tooltip({ title: info.event.title });
        },
        timeFormat: 'H(:mm)' // uppercase H for 24-hour clock
      });

      calendar.render();
    }

    function loadCalendar() {
      // criar xmlhttprequest
      var xhr = new XMLHttpRequest();
      xhr.open("GET", "http://" + actualURL + "/get-tickets");

      xhr.onload = function () {
        if (xhr.status === 200) {
          var data = JSON.parse(xhr.responseText);

          var arrayok = [];


          for (let i = 0; i < data.data.length; i++) {
            const element = data.data[i];



            var day = data.data[i].start.substring(0, 2);
            var month = data.data[i].start.substring(3, 5);
            var year = data.data[i].start.substring(6, 10);
            var hour = data.data[i].start.substring(11, 13);
            var min = data.data[i].start.substring(14, 16);
            var sec = data.data[i].start.substring(17, 20);


            var dateok = year + '-' + month + '-' + day + 'T' + hour + ':' + min;


            var datetitlestart = day + '/' + month + '/' + year + ' - ' + hour + ':' + min;

            console.log(data.data[i].title + data.data[i].name);

            data.data[i].start = dateok;

            data.data[i].url = "http://" + actualURL + "/os-detail?id=" + data.data[i].url;

            var dateend = moment(dateok).add(data.data[i].end, 'hours').format("YYYY-MM-DDTHH:mm");
            var datetitleend = moment(dateok).add(data.data[i].end, 'hours').format("DD/MM/YYYY - HH:mm");

            data.data[i].end = dateend;

            data.data[i].title = data.data[i].title + " - Técnico: " + data.data[i].name + " - Início: " + datetitlestart + " - Prazo: " + datetitleend;



          }

          BuildCalendar(data.data);
        }
      }
      xhr.send();
    }

    loadCalendar();

  </script>





</body>

</html>